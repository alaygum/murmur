<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú—É—Ä–º—É—Ä</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1b0f2a;
      --card:#0f1733cc;
      --text:#f6f7ff;
      --yes:#ff4fd8;
      --yes2:#ffb84f;
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(1200px 700px at 20% 10%, #2c1b53 0%, transparent 55%),
                  radial-gradient(900px 600px at 90% 80%, #1a5a4d 0%, transparent 55%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overflow:hidden;
    }

    .card{
      width:min(720px, 92vw);
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:22px 18px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      position:relative;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .2px;
      text-align:center;
      line-height:1.15;
    }

    .gifWrap{
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 18px 0 18px 0;
    }

    .gifWrap img{
      max-width:min(520px, 86vw);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      background: rgba(255,255,255,.03);
    }

    .stage{
      width:min(520px, 86vw);
      height: 140px;
      margin: 0 auto;
      position:relative;
      user-select:none;
      touch-action: manipulation;
    }

    button{
      border:0;
      border-radius: 999px;
      padding: 14px 22px;
      font-size: 18px;
      font-weight: 750;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position:absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      white-space:nowrap;
    }

    .yesBtn{
      left: 25%;
      cursor:pointer;
      background: linear-gradient(135deg, var(--yes), var(--yes2));
      color:#17061c;
      text-shadow: 0 1px 0 rgba(255,255,255,.25);
      filter: saturate(1.1);
      animation: breathe 1.9s ease-in-out infinite;
      transition: transform .15s ease, filter .15s ease;
    }
    .yesBtn:hover{
      transform: translate(-50%, -50%) scale(1.08);
      filter: brightness(1.05) saturate(1.2);
    }
    @keyframes breathe{
      0%{ transform: translate(-50%, -50%) scale(1.00); }
      50%{ transform: translate(-50%, -50%) scale(1.04); }
      100%{ transform: translate(-50%, -50%) scale(1.00); }
    }

    .noBtn{
      left: 75%;
      cursor:not-allowed;
      background: rgba(255,255,255,.10);
      color: #e8ebff;
      border:1px solid rgba(255,255,255,.18);
    }

    .hidden{ display:none; }

    .puff{
      position:fixed;
      font-size: 20px;
      pointer-events:none;
      z-index: 10;
      --rot: 0deg;
      --dx1: 0px;
      --dy1: 0px;
      --dx2: 0px;
      --dy2: 0px;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.35));
      animation: puffOut .55s ease forwards;
    }

    @keyframes puffOut{
      0%{
        opacity:0;
        transform: translate(-50%, -50%) rotate(var(--rot)) scale(.7);
      }
      15%{
        opacity:1;
        transform: translate(calc(-50% + var(--dx1)), calc(-50% + var(--dy1))) rotate(var(--rot)) scale(1);
      }
      100%{
        opacity:0;
        transform: translate(calc(-50% + var(--dx2)), calc(-50% + var(--dy2))) rotate(var(--rot)) scale(1.25);
      }
    }

    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 20;
      overflow:hidden;
    }
    .confetti span{
      position:absolute;
      width: 10px;
      height: 16px;
      border-radius: 4px;
      opacity:.95;
      transform: translateY(-30px) rotate(0deg);
      animation: fall 1.2s ease-in forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(360deg); opacity:0.85; }
    }

    @media (prefers-reduced-motion: reduce){
      .yesBtn{ animation:none; }
      button{ transition:none; }
    }
  </style>
</head>
<body>
  <div class="card">
    <div id="viewAsk">
      <h1>–¢—ã –±—É–¥–µ—à—å –º–æ–∏–º –ú—É—Ä–º—É—Ä–æ–º?</h1>

      <div class="gifWrap">
        <img id="mainGif" src="ask.gif" alt="–ö–æ—Ç—ë–Ω–æ–∫" loading="eager" />
      </div>

      <div class="stage" id="stage">
        <button class="yesBtn" id="yesBtn">–î–∞ üíò</button>
        <button class="noBtn" id="noBtn">–ù–µ—Ç</button>
      </div>
    </div>

    <div id="viewYes" class="hidden">
      <h1>–£—Ä–∞!<br>–ú–æ–π –ª—é–±–∏–º—ã–π –ª–∞—Å–∫–æ–≤—ã–π –ú—É—Ä–º—É—Ä!</h1>

      <div class="gifWrap">
        <img id="celebrateGif" src="celebrate.gif" alt="–ü—Ä–∞–∑–¥–Ω—É–µ–º" loading="eager" />
      </div>
    </div>
  </div>

  <div class="confetti hidden" id="confetti"></div>

  <script>
    const ASSETS = {
      ask: "ask.gif",
      celebrate: "celebrate.gif"
    };

    const viewAsk = document.getElementById("viewAsk");
    const viewYes = document.getElementById("viewYes");
    const mainGif = document.getElementById("mainGif");
    const celebrateGif = document.getElementById("celebrateGif");

    const stage = document.getElementById("stage");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const confetti = document.getElementById("confetti");

    [ASSETS.ask, ASSETS.celebrate].forEach(src => {
      const img = new Image();
      img.src = src;
    });
    mainGif.src = ASSETS.ask;
    celebrateGif.src = ASSETS.celebrate;

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è "–ù–µ—Ç"
    const SAFE_DIST = 105;        // –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ –∫—É—Ä—Å–æ—Ä–∞
    const GAP_TO_YES = 18;        // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∑–æ—Ä –¥–æ "–î–∞"
    const MARGIN = 10;            // –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—ë–≤ stage
    const HISTORY_LIMIT = 6;      // —á—Ç–æ–±—ã –Ω–µ –∑–∞–ª–∏–ø–∞–ª–∞ –≤ 2 —Ç–æ—á–∫–∏
    const HISTORY_MIN_SEP = 55;   // –Ω–µ –ø—Ä—ã–≥–∞—Ç—å –≤ –æ—á–µ–Ω—å –±–ª–∏–∑–∫—É—é –ø—Ä–æ—à–ª—É—é –ø–æ–∑–∏—Ü–∏—é
    const SAMPLES = 140;          // —Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä—ã–∂–æ–∫

    let lastPos = [];
    let rafId = null;

    function rectsOverlap(a, b){
      return !(b.left > a.right || b.right < a.left || b.top > a.bottom || b.bottom < a.top);
    }

    function getStageRect(){ return stage.getBoundingClientRect(); }

    function getRectInClient(el){ return el.getBoundingClientRect(); }

    function getCenterClient(el){
      const r = getRectInClient(el);
      return { x: r.left + r.width/2, y: r.top + r.height/2, r };
    }

    function clientToStage(x, y){
      const sr = getStageRect();
      return { x: x - sr.left, y: y - sr.top };
    }

    function setNoCenterStage(x, y){
      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
      noBtn.style.transform = "translate(-50%, -50%)";
    }

    function getNoCenterStage(){
      const sr = getStageRect();
      const c = getCenterClient(noBtn);
      return { x: c.x - sr.left, y: c.y - sr.top, clientX: c.x, clientY: c.y };
    }

    function dist(a, b){
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return Math.hypot(dx, dy);
    }

    function spawnPuffFromMove(oldClient, newClient){
      const vx = newClient.x - oldClient.x;
      const vy = newClient.y - oldClient.y;
      const len = Math.hypot(vx, vy) || 1;

      // –ü—É–∫ –ª–µ—Ç–∏—Ç "–≤ —Ö–≤–æ—Å—Ç", —Ç–æ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ –¥–≤–∏–∂–µ–Ω–∏—é
      const ux = -(vx / len);
      const uy = -(vy / len);

      const dx2 = ux * 30;
      const dy2 = uy * 30;
      const dx1 = ux * 10;
      const dy1 = uy * 10;

      const angle = Math.atan2(uy, ux) * 180 / Math.PI;

      const el = document.createElement("div");
      el.className = "puff";
      el.textContent = "üí®";
      el.style.left = oldClient.x + "px";
      el.style.top = oldClient.y + "px";
      el.style.setProperty("--rot", angle + "deg");
      el.style.setProperty("--dx1", dx1 + "px");
      el.style.setProperty("--dy1", dy1 + "px");
      el.style.setProperty("--dx2", dx2 + "px");
      el.style.setProperty("--dy2", dy2 + "px");

      document.body.appendChild(el);
      setTimeout(() => el.remove(), 650);
    }

    function isFarFromHistory(p){
      for(const h of lastPos){
        const d = Math.hypot(p.x - h.x, p.y - h.y);
        if(d < HISTORY_MIN_SEP) return false;
      }
      return true;
    }

    function inflatedRect(r, pad){
      return { left:r.left - pad, right:r.right + pad, top:r.top - pad, bottom:r.bottom + pad };
    }

    function pickNewNoPos(cursorClientX, cursorClientY){
      const sr = getStageRect();
      const noR = getRectInClient(noBtn);
      const yesR = getRectInClient(yesBtn);

      const cursor = clientToStage(cursorClientX, cursorClientY);

      const minX = MARGIN + noR.width/2;
      const maxX = sr.width - MARGIN - noR.width/2;
      const minY = MARGIN + noR.height/2;
      const maxY = sr.height - MARGIN - noR.height/2;

      const yesInflated = inflatedRect(yesR, GAP_TO_YES);

      let best = null;

      for(let i = 0; i < SAMPLES; i++){
        const x = minX + Math.random() * (maxX - minX);
        const y = minY + Math.random() * (maxY - minY);

        const candidate = { x, y };

        const dCursor = dist(candidate, cursor);
        if(dCursor < SAFE_DIST) continue;

        if(!isFarFromHistory(candidate)) continue;

        const candClientRect = {
          left: sr.left + x - noR.width/2,
          right: sr.left + x + noR.width/2,
          top: sr.top + y - noR.height/2,
          bottom: sr.top + y + noR.height/2
        };

        if(rectsOverlap(candClientRect, yesInflated)) continue;

        // –°–∫–æ—Ä–∏–Ω–≥: —Ö–æ—Ç–∏–º –±—ã—Ç—å –¥–∞–ª–µ–∫–æ –æ—Ç –∫—É—Ä—Å–æ—Ä–∞ –∏ –Ω–µ –ª–∏–ø–Ω—É—Ç—å –∫ "–î–∞"
        const yesCenter = { x: (yesR.left + yesR.right)/2 - sr.left, y: (yesR.top + yesR.bottom)/2 - sr.top };
        const dYes = dist(candidate, yesCenter);

        const score = dCursor * 1.0 + dYes * 0.35;

        if(!best || score > best.score){
          best = { x, y, score };
        }
      }

      // –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ—Å—Ç–æ —Ç–µ–ª–µ–ø–æ—Ä—Ç –≤ —Å–∞–º—ã–π –¥–∞–ª—å–Ω–∏–π —É–≥–æ–ª –æ—Ç –∫—É—Ä—Å–æ—Ä–∞
      if(!best){
        const corners = [
          { x: minX, y: minY },
          { x: maxX, y: minY },
          { x: minX, y: maxY },
          { x: maxX, y: maxY }
        ];
        corners.sort((a,b) => dist(b, cursor) - dist(a, cursor));
        best = corners[0];
      }

      return best;
    }

    function moveNoIfClose(cursorClientX, cursorClientY){
      const noC = getCenterClient(noBtn);
      const d = Math.hypot(noC.x - cursorClientX, noC.y - cursorClientY);

      if(d >= SAFE_DIST) return;

      const oldNo = getNoCenterStage();
      const next = pickNewNoPos(cursorClientX, cursorClientY);

      setNoCenterStage(next.x, next.y);

      const newCenterClient = getCenterClient(noBtn);
      spawnPuffFromMove({ x: oldNo.clientX, y: oldNo.clientY }, { x: newCenterClient.x, y: newCenterClient.y });

      lastPos.unshift({ x: next.x, y: next.y });
      lastPos = lastPos.slice(0, HISTORY_LIMIT);
    }

    function onPointerMove(e){
      if(rafId) return;
      const x = e.clientX;
      const y = e.clientY;
      rafId = requestAnimationFrame(() => {
        rafId = null;
        moveNoIfClose(x, y);
      });
    }

    document.addEventListener("mousemove", onPointerMove, { passive: true });

    // –ï—Å–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ –ø–æ—á—Ç–∏ –ø–æ–π–º–∞–ª–∏ "–ù–µ—Ç", –æ–Ω–∞ –¥–µ—Ä–≥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
    noBtn.addEventListener("mouseenter", (e) => {
      moveNoIfClose(e.clientX, e.clientY);
    });

    // –ú–æ–±–∏–ª–∫–∏
    stage.addEventListener("touchstart", (e) => {
      const t = e.touches && e.touches[0];
      if(!t) return;
      moveNoIfClose(t.clientX, t.clientY);
    }, { passive: true });

    stage.addEventListener("touchmove", (e) => {
      const t = e.touches && e.touches[0];
      if(!t) return;
      moveNoIfClose(t.clientX, t.clientY);
    }, { passive: true });

    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      const c = getCenterClient(noBtn);
      spawnPuffFromMove({ x: c.x, y: c.y }, { x: c.x - 10, y: c.y + 10 });
    });

    function launchConfetti(){
      confetti.classList.remove("hidden");
      confetti.innerHTML = "";
      const pieces = 28;

      for(let i = 0; i < pieces; i++){
        const s = document.createElement("span");
        s.style.left = (Math.random() * 100) + "vw";
        s.style.top = (-10 - Math.random() * 30) + "px";

        const w = 6 + Math.random() * 10;
        const h = 10 + Math.random() * 18;
        s.style.width = w + "px";
        s.style.height = h + "px";

        const hue = Math.floor(Math.random() * 360);
        s.style.background = `hsla(${hue}, 90%, 70%, 0.95)`;

        confetti.appendChild(s);
      }

      setTimeout(() => {
        confetti.classList.add("hidden");
        confetti.innerHTML = "";
      }, 1400);
    }

    yesBtn.addEventListener("click", () => {
      launchConfetti();
      viewAsk.classList.add("hidden");
      viewYes.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "instant" });
    });

    // –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
    (function init(){
      // "–î–∞" —Å–ª–µ–≤–∞, "–ù–µ—Ç" —Å–ø—Ä–∞–≤–∞, –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
      setNoCenterStage(stage.clientWidth * 0.75, stage.clientHeight * 0.5);
      lastPos = [{ x: stage.clientWidth * 0.75, y: stage.clientHeight * 0.5 }];
    })();
  </script>
</body>
</html>
